<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="portal_my_home_leases" inherit_id="portal.portal_my_home" name="My Leases" customize_show="True" priority="30">
        <xpath expr="//div[hasclass('o_portal_docs')]" position="before">
            <t t-set="portal_client_category_enable" t-value="True"/>
        </xpath>
        <xpath expr="//div[@id='portal_client_category']" position="inside">
            <t t-call="portal.portal_docs_entry">
                <t t-set="icon" t-value="'/property_tent_portal/static/src/img/lease_icon.png'"/>
                <t t-set="title">Leases</t>
                <t t-set="text">View your lease contracts</t>
                <t t-set="url" t-value="'/my/leases'"/>
                <t t-set="placeholder_count" t-value="'lease_count'"/>
                <t t-set="count" t-value="lease_count"/>
                <t t-set="config_card" t-value="True"/>
            </t>
        </xpath>
    </template>

    <template id="portal_my_leases" name="My Leases">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            <t t-set="page_name" t-value="'leases'"/>
            <div class="o_portal_wrap">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2 class="mb-1">My Leases</h2>
                        <div class="text-muted">All active and past leases</div>
                    </div>
                </div>
                <t t-if="not leases">
                    <div class="alert alert-warning">No leases found.</div>
                </t>
                <t t-if="leases">
                    <div class="table-responsive">
                        <table class="table table-hover o_portal_table align-middle">
                            <thead class="table-light">
                            <tr>
                                <th>Lease</th>
                                <th>Unit</th>
                                <th>Start</th>
                                <th>End</th>
                                <th>Rent</th>
                                <th>Status</th>
                            </tr>
                            </thead>
                            <tbody>
                            <t t-foreach="leases" t-as="lease">
                                <tr>
                                    <td>
                                        <a t-att-href="'/my/leases/%s' % lease.id">
                                            <t t-esc="lease.name"/>
                                        </a>
                                    </td>
                                    <td><t t-esc="lease.unit_id.name"/></td>
                                    <td><t t-esc="lease.start_date"/></td>
                                    <td><t t-esc="lease.end_date"/></td>
                                    <td><t t-esc="lease.rent_amount"/></td>
                                    <td><span class="badge text-bg-info text-uppercase"><t t-esc="lease.state"/></span></td>
                                </tr>
                            </t>
                            </tbody>
                        </table>
                    </div>
                </t>
                <t t-call="portal.pager"/>
            </div>
        </t>
    </template>

    <template id="portal_lease_detail" name="Lease Details">
        <t t-call="portal.portal_layout">
            <t t-set="page_name" t-value="'leases'"/>
            <div class="o_portal_wrap">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <h2 class="mb-1">Lease <t t-esc="lease.name"/></h2>
                        <div class="text-muted">Lease details and invoices</div>
                    </div>
                </div>
                <div class="card mb-4">
                    <div class="card-header bg-light">
                        <strong>Lease Details</strong>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-sm-6">
                                <div class="text-muted small">Unit</div>
                                <div class="fw-semibold"><t t-esc="lease.unit_id.name"/></div>
                            </div>
                            <div class="col-sm-6">
                                <div class="text-muted small">Property</div>
                                <div class="fw-semibold"><t t-esc="lease.property_id.name"/></div>
                            </div>
                            <div class="col-sm-6">
                                <div class="text-muted small">Start Date</div>
                                <div class="fw-semibold"><t t-esc="lease.start_date"/></div>
                            </div>
                            <div class="col-sm-6">
                                <div class="text-muted small">End Date</div>
                                <div class="fw-semibold"><t t-esc="lease.end_date"/></div>
                            </div>
                            <div class="col-sm-6">
                                <div class="text-muted small">Rent Amount</div>
                                <div class="fw-semibold"><t t-esc="lease.rent_amount"/></div>
                            </div>
                            <div class="col-sm-6">
                                <div class="text-muted small">Status</div>
                                <span class="badge text-bg-info text-uppercase"><t t-esc="lease.state"/></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header bg-light">
                        <strong>Invoice Schedule</strong>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-sm-6">
                                <div class="text-muted small">Next Invoice Date</div>
                                <div class="fw-semibold"><t t-esc="lease.next_invoice_date"/></div>
                            </div>
                            <div class="col-sm-6">
                                <div class="text-muted small">Last Invoice Date</div>
                                <div class="fw-semibold"><t t-esc="lease.last_invoice_date"/></div>
                            </div>
                        </div>
                    </div>
                </div>

                <h5 class="mt-4 mb-3">Invoices</h5>
                <t t-if="not invoices">
                    <div class="alert alert-warning">No invoices found.</div>
                </t>
                <t t-if="invoices">
                    <div class="table-responsive">
                        <table class="table table-hover o_portal_table align-middle">
                            <thead class="table-light">
                            <tr>
                                <th>Invoice</th>
                                <th>Date</th>
                                <th>Due Date</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Pay</th>
                            </tr>
                            </thead>
                            <tbody>
                            <t t-foreach="invoices" t-as="inv">
                                <tr>
                                    <td>
                                        <a t-att-href="'/my/invoices/%s?access_token=%s' % (inv.id, inv._portal_ensure_token())">
                                            <t t-esc="inv.name"/>
                                        </a>
                                    </td>
                                    <td><t t-esc="inv.invoice_date"/></td>
                                    <td><t t-esc="inv.invoice_date_due"/></td>
                                    <td><t t-esc="inv.amount_total"/></td>
                                    <td><span class="badge text-bg-info text-uppercase"><t t-esc="inv.state"/></span></td>
                                    <td>
                                        <t t-if="inv.state == 'posted' and inv.amount_residual &gt; 0">
                                            <a class="btn btn-primary btn-sm" t-att-href="'/my/invoices/%s?access_token=%s' % (inv.id, inv._portal_ensure_token())">Pay Now</a>
                                        </t>
                                        <t t-else="">-</t>
                                    </td>
                                </tr>
                            </t>
                            </tbody>
                        </table>
                    </div>
                </t>
            </div>
        </t>
    </template>
</odoo>
